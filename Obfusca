-- Function to play sound
local function playSound(SoundId, Volume)
    local Sound = Instance.new("Sound")
    Sound.Name = "Sound"
    Sound.SoundId = "http://www.roblox.com/asset/?id=" .. SoundId
    Sound.Volume = Volume
    Sound.Looped = false
    Sound.Archivable = false
    Sound.Parent = workspace

    Sound:Play()
    Sound.Ended:Connect(function()
        Sound:Destroy()
    end)
end

-- Function to create a bullet tracer effect with attachments
local function createBulletTracer(startPos, endPos)
    -- Create attachments
    local fromAttach = Instance.new("Attachment", workspace.Terrain)
    fromAttach.Position = startPos

    local toAttach = Instance.new("Attachment", workspace.Terrain)
    toAttach.Position = endPos

    -- Create a beam instance
    local beam = Instance.new("Beam")
    beam.Attachment0 = fromAttach
    beam.Attachment1 = toAttach
    beam.FaceCamera = true
    beam.Width0 = 0.1
    beam.Width1 = 0.1
    beam.Transparency = NumberSequence.new(0.5)
    beam.Color = ColorSequence.new(Color3.fromRGB(255, 0, 0)) -- Red color
    beam.LightEmission = 1
    beam.LightInfluence = 0
    beam.Texture = "" -- Optional: add texture ID here
    beam.TextureMode = Enum.TextureMode.Stretch
    beam.TextureLength = 1
    beam.TextureSpeed = 0

    beam.Parent = workspace

    -- Play the sound using the custom function
    local bellSoundId = "6832470734" -- Updated sound ID
    playSound(bellSoundId, 1)

    -- Destroy the beam and attachments after 4 seconds
    game.Debris:AddItem(fromAttach, 4)
    game.Debris:AddItem(toAttach, 4)
    game.Debris:AddItem(beam, 4)
end

-- Function to handle shooting
local function onShoot()
    local player = game.Players.LocalPlayer
    local character = player.Character
    if player and character then
        local tool = character:FindFirstChildOfClass("Tool")
        if tool then
            local camera = game.Workspace.CurrentCamera
            local startPos = camera.CFrame.Position
            
            -- Create a ray from the camera through the center of the screen
            local viewportRay = camera:ViewportPointToRay(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
            local direction = viewportRay.Direction.unit
            
            -- Define the end position for the bullet tracer
            local endPos = startPos + direction * 100
            
            -- Create a bullet tracer effect from the direction you're looking at
            createBulletTracer(startPos, endPos)

            -- Fire the shoot event to the server
            local shootRemote = game.ReplicatedStorage:WaitForChild("ShootRemote")
            shootRemote:FireServer(tool, endPos)
        end
    end
end

-- Connect shooting event when the tool is equipped
local function onToolEquipped(tool)
    local player = game.Players.LocalPlayer
    local mouse = player:GetMouse()
    mouse.Button1Down:Connect(onShoot)
end

-- Disconnect shooting event when the tool is unequipped
local function onToolUnequipped(tool)
    local player = game.Players.LocalPlayer
    local mouse = player:GetMouse()
    mouse.Button1Down:Disconnect(onShoot)
end

-- Listen for tool equipped and unequipped events
local player = game.Players.LocalPlayer
player.Character.ChildAdded:Connect(function(child)
    if child:IsA("Tool") then
        onToolEquipped(child)
    end
end)

player.Character.ChildRemoved:Connect(function(child)
    if child:IsA("Tool") then
        onToolUnequipped(child)
    end
end)

-- Ensure existing tool (if any) is connected
for _, child in ipairs(player.Character:GetChildren()) do
    if child:IsA("Tool") then
        onToolEquipped(child)
    end
end
